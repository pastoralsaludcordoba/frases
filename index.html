<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Mensajes de Esperanza — Pastoral de la Salud Córdoba</title>
<link rel="icon" type="image/png" href="favicon-32x32.png">
<meta name="description" content="Mensajes bíblicos de esperanza, consuelo y fortaleza para enfermos, familiares, médicos y acompañantes. Pastoral de la Salud de la Arquidiócesis de Córdoba.">
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
font-family:system-ui;
background:#fff;
color:#333;
padding:32px;
display:flex;
flex-direction:column;
align-items:center;
text-align:center;
}
.logo{width:150px;margin-bottom:20px;}
.title{font-size:2.5rem;font-weight:700;color:#ff7a00;margin-bottom:6px;}
.subtitle{color:#777;margin-bottom:30px;}
.message{
font-size:1.7rem;
font-weight:700;
margin-bottom:20px;
}
 .logo-footer{
width:70px;
opacity:0.8;
margin-top:60px;
}
.buttons{
display:flex;
flex-direction:column;
gap:12px;
width:240px;
}
button{
border:none;
border-radius:999px;
padding:12px;
font-weight:600;
cursor:pointer;
color:#fff;
}
.primary{background:#ff7a00;}
.secondary{background:#005bbb;}
</style>
</head>

<body>
<img src="logo_frases.png" class="logo" alt="Pastoral de la Salud de la Arquidiócesis de Córdoba">
<h1 class="title">No estás solo</h1>
<h2 class="subtitle">Con Jesús te acompañamos</h2>

<p id="message" class="message">Cargando mensaje...</p>

<div class="buttons">
<button class="primary" onclick="newMessage()">Más mensajes</button>
<button class="secondary" onclick="share()">Compartir</button>
</div>

<script>
  let frases = [];
  let orden = [];
  let posicion = 0;

  const messageEl = document.getElementById("message");

  function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  function buildNewOrder() {
    orden = shuffle([...Array(frases.length).keys()]);
    posicion = 0;
    localStorage.setItem("ordenFrases", JSON.stringify(orden));
    localStorage.setItem("posicionFrases", String(posicion));
  }

  function mostrarMensaje() {
    if (!frases.length) return;

    if (!orden.length || orden.length !== frases.length) {
      buildNewOrder();
    }

    if (posicion >= orden.length) {
      buildNewOrder(); // terminó el ciclo: mezcla de nuevo y arranca
    }

    const frase = frases[orden[posicion]];
    messageEl.innerText = '"' + frase + '"';

    localStorage.setItem("posicionFrases", String(posicion));
  }

  function newMessage() {
    posicion = (Number(localStorage.getItem("posicionFrases")) || 0) + 1;
    localStorage.setItem("posicionFrases", String(posicion));
    mostrarMensaje();
  }

  async function loadFrases() {
    try {
      // cache busting: evita que el navegador quede con versiones viejas
      const res = await fetch("frases.txt?v=" + Date.now());

      if (!res.ok) throw new Error("No se pudo cargar frases.txt (HTTP " + res.status + ")");

      const text = await res.text();
      frases = text.split("\n").map(s => s.trim()).filter(Boolean);

      if (!frases.length) throw new Error("frases.txt está vacío");

      // restaurar orden/posición si existe
      try {
        orden = JSON.parse(localStorage.getItem("ordenFrases") || "[]");
      } catch {
        orden = [];
      }
      posicion = Number(localStorage.getItem("posicionFrases")) || 0;

      // si el archivo cambió (cantidad distinta), regenerar orden
      if (!orden.length || orden.length !== frases.length) {
        buildNewOrder();
      }

      // mostrar el actual
      mostrarMensaje();
    } catch (e) {
      messageEl.innerText = "No se pudo cargar las frases. Revisá que exista frases.txt en el repositorio.";
      console.error(e);
    }
  }

  // Exponer para el botón onclick
  window.newMessage = newMessage;

  loadFrases();
</script>

<footer>
<img src="logo_footer_app .png" class="logo-footer">
</footer>
</body>
</html>
